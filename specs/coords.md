# Q3DC Coordinate Systems Specification

## 1. Overview

This specification defines the relationship between the Real Board Coordinate System (RCS) and the Virtual Tile Space (VTS) used by Q3DC. Only **one** board exists at a time; the **VTS belongs to the board**. The VTS is a fixed 30×30×30 cube of virtual tiles, large enough to support all legal 3D-chess geometry (off‑board rays, slants, planes). The board is positioned inside this cube via a coupled **board size + anchor** configuration.

---

## 2. Virtual Tile Space (VTS)

```
VTS dimensions: 30 × 30 × 30
Indices:        0 … 29 in each dimension (z, x, y)
```

* VTS is **generated by the board configuration**.
* VTS does **not** host multiple real boards.
* VTS is a *tile-cloud* surrounding the real board to support off-board geometry.

The real board is always placed inside the VTS via a computed **anchor**.

---

## 3. Real Coordinate System (RCS)

### 3.1 Level Labels (LL)

Level-label sequences are **board-size dependent**. Each board defines its own ordered set of LL values from bottom to top, starting at QR.

#### For an 8×8×8 board:

```
LL ∈ { QR, QN, QB, Q, K, KB, KN, KR }
Mapping:
  QR→1, QN→2, QB→3, Q→4, K→5, KB→6, KN→7, KR→8
```

#### For a 10×10×10 board:

```
LL ∈ { QR, QN, QB, QD, Q, K, KD, KB, KN, KR }
Mapping:
  QR→1, QN→2, QB→3, QD→4, Q→5, K→6, KD→7, KB→8, KN→9, KR→10
```

**Rule:** The level-label sequence and its numeric mapping are tightly **coupled to board size**. Changing N requires regenerating both.

### 3.2 Board Coordinates

Board Coordinates

```
RCS tile: <LL> X, Y
X ∈ [1, N]
Y ∈ [1, N]
```

where N is the board edge length.

---

## 4. BoardConfig (Coupled Board Size + Anchor)

A BoardConfig defines the geometry of the **single active board**, and therefore generates its corresponding Virtual Tile Space (VTS). Board size and anchor are **coupled** and must always be updated together.

### 4.1 Board Size

Support both symmetric and asymmetric boards:

```
# symmetric
N:  integer        # board edge length for NxNxN boards

# asymmetric
Nz: integer        # number of real levels
Nx: integer        # x-extent
Ny: integer        # y-extent
```

Rules:

* If `N` is provided, `Nz=Nx=Ny=N`.
* If any of `Nz, Nx, Ny` are provided, they override `N`.
* QR is always real-level 1; the highest level is real-level Nz.
* RCS is **1-offset**; all real coordinates start at 1.
* VTS is **0-offset**.

### 4.2 Anchor

The anchor is always the VTS coordinate of tile `QR1,1`:

```
anchor = [Az, Ax, Ay]   # JSON array, VTS coordinates
```

Anchor and board size determine all board extents inside VTS.

### 4.3 Board Ranges

Because RCS uses **1-offset**, only the **maximum bounds** are required:

```
max_ll = Nz
max_x  = Nx
max_y  = Ny
```

These define the on-board conditions:

```
1 ≤ LL_value ≤ max_ll
1 ≤ X ≤ max_x
1 ≤ Y ≤ max_y
```

Ranges in VTS are computed from size + anchor:

```
z-range: Az .. (Az + Nz - 1)
x-range: Ax .. (Ax + Nx - 1)
y-range: Ay .. (Ay + Ny - 1)
```

### 4.4 Level Labels Are Board-Size Dependent

Each board defines its own ascending LL-label set from bottom (QR) to top (KR or its extended forms for larger boards). The mapping must match Nz.

### 4.5 Multiple BoardConfigs

The system may store multiple board definitions in a registry, but **only one** may be active at a time.

## 5. Coordinate Conversions Coordinate Conversions

### 5.1 RCS → VTS

Given:

```
RCS: <LL> X, Y
LL_value = level_map[LL]  # 1..N
```

Compute:

```
z = Az + (LL_value − 1)
x = Ax + (X − 1)
y = Ay + (Y − 1)
```

Return: `(z, x, y)`

---

### 5.2 VTS → RCS

Given:

```
(z, x, y)
```

Compute:

```
LL_value = (z − Az) + 1
X        = (x − Ax) + 1
Y        = (y − Ay) + 1
LL       = inverse_level_map[LL_value]
```

Tile is on-board only if:

```
1 ≤ LL_value ≤ N
1 ≤ X ≤ N
1 ≤ Y ≤ N
```

Otherwise: OFFBOARD.

---

## 6. Directional Orientation Rules

Players stand on opposite **vertical** edges.
Movement orientation is:

```
(+x, +y) = forward toward opponent
(+x, −y) = left
(−x, +y) = right
(−x, −y) = back toward player
```

These are global invariants and apply identically in both VTS and RCS.

---

## 7. UI / Engine Requirements

* UI must **not** hard-code board size or anchor.
* All geometry queries must pass through the active BoardConfig.
* VTS transforms must always reference BoardConfig.anchor and BoardConfig.N.
* No assumptions about fixed positions of levels, X/Y origins, or board extents.

---

## 8. Summary

* One active board.
* The board generates the VTS.
* VTS = fixed 30³ tile-cloud.
* Anchor = VTS coordinate of QR1,1.
* Board size and anchor are tightly coupled.
* RCS↔VTS transforms use simple offset formulas.
* Directional rules reflect Q3DC geometry, not conventional 3D gaming.

This specification is now canonical for coordinate handling in Q3DC.
