# Coordinates Spec (L0)
  This file contains the complete coordinate-layer specification for Q3DC. It corresponds to Layer L0 of the geometry stack and defines VTS, RCS, BoardConfig, and all coordinate transforms.

# 1. Scope
  Defines:

  * Virtual Tile Space (VTS)
  * Real Coordinate System (RCS)
  * Board configurations (size + anchor)
  * Coordinate conversions (RCS ↔ VTS)
  * On-board / off-board logic
  * Directional conventions

  Does **not** include rays, colors, planes, quadrants, or movement logic.

  All coordinates in this layer are **integers** only.

# 2. Virtual Tile Space (VTS)
  ```
  Dimensions: 30 × 30 × 30
  Indices:    0 … 29 in (z, x, y)
  Offset:     zero-offset
  ```

  Rules:

  * Only **one** real board exists at a time.
  * The VTS is **generated by** the active BoardConfig.
  * VTS never contains more than one board.
  * VTS is a 30³ "tile cloud" providing space for off-board geometry.
  * All VTS coordinates must be integers in [0, 29].
  * Conceptually, the board generates a VTS shell as thick as the board dimensions.
  * It is fixed at 30 for mathematical convenience, as that covers all board sizes.

# 3. Real Coordinate System (RCS)
  ## 3.1 Format
    ```
    RCS tile: <LL>X,Y
    Offset:   one-offset
    ```

    * `<LL>` : level label
    * `X, Y` : integers ≥ 1
    * All RCS coordinates must be **integers only**.

  ## 3.2 Level Labels
    Level labels are **board-size dependent**.

    Rules:
      * Lowest level label is always **QR**.
      * Highest level label corresponds exactly to index **Nz**.
      * A unique mapping exists:
        * `LL → index (1…Nz)`
        * `index (1…Nz) → LL`

    Examples:
      * Nz = 8  → {QR, QN, QB, Q, K, KB, KN, KR}
      * Nz = 10 → {QR, QN, QB, QD, Q, K, KD, KB, KN, KR}

  ## 3.2 RCS Bounds
    Symmetric boards:
      ```
      X ∈ [1,N]
      Y ∈ [1,N]
      LL ∈ [1,N]
      ```

    Asymmetric boards:
      ```
      X ∈ [1,Nx]
      Y ∈ [1,Ny]
      LL ∈ [1,Nz]
      ```

# 4. Board Configurations (Coupled Size + Anchor)
  A BoardConfig defines the geometry of the **single active board**.

  ## 4.1 Board Size
    Two forms are supported:

    ### Symmetric
      ```
      N  → Nz = Nx = Ny = N
      ```

    ### Asymmetric
      ```
      Nz: number of vertical layers
      Nx: x-extent
      Ny: y-extent
      ```

    Rules:
      * If `N` exists, it overrides Nz/Nx/Ny.
      * If any of Nz/Nx/Ny exist, they override N.
      * RCS is always 1-offset.
      * VTS is always 0-offset.

  ## 4.2 Anchor
    Anchor is the VTS coordinate of tile **QR1,1**.
    ```
    anchor = (Az, Ax, Ay)
    ```

    Rules:
      * Board size and anchor are **coupled**.
      * Changing either requires recomputing both.
      * Anchor must be an integer triple.
      * The board must fit entirely within VTS.

  ## 4.3 Board Ranges
    RCS maximum bounds:
      ```
      max_ll = Nz
      max_x  = Nx
      max_y  = Ny
      ```

    VTS bounds:
      ```
      z ∈ [Az, Az + Nz − 1]
      x ∈ [Ax, Ax + Nx − 1]
      y ∈ [Ay, Ay + Ny − 1]
      ```

  ## 4.4 Board Selection
    Higher level code instantiates an allowed board (size & anchor). 
      ```
      Can query to discover allowed boards.
      Slect and create a specific board.
      ```

# 5. Coordinate Transforms
  Transforms must be **lossless**, **invertible**, and **integer-preserving**.

  ## 5.1 RCS → VTS
    Given:
      ```
      <LL>X,Y
      LL_value = level_map[LL]
      ```

    Compute:
      ```
      z = Az + (LL_value − 1)
      x = Ax + (X − 1)
      y = Ay + (Y − 1)
      ```

    Return:
      ```
      (z,x,y)
      ```

  ## 5.2 VTS → RCS
    Given:
      ```
      (z,x,y)
      ```

    Compute:
      ```
      LL_value = (z − Az) + 1
      X        = (x − Ax) + 1
      Y        = (y − Ay) + 1
      LL       = inverse_level_map[LL_value]
      ```

    Tile is **on-board** iff RCS bounds are satisfied.

    Returns:
      A structured token (e.g. "OFFBOARD", null, or a dedicated object).
      If out of bounds: return **OFFBOARD**, 

# 6. On-Board / Off-Board
  Symmetric:
    ```
    1 ≤ LL ≤ N
    1 ≤ X ≤ N
    1 ≤ Y ≤ N
    ```

  Asymmetric:
    ```
    1 ≤ LL ≤ Nz
    1 ≤ X ≤ Nx
    1 ≤ Y ≤ Ny
    ```

  Any violation → OFFBOARD.

# 7. Engine Requirements
  * Only one BoardConfig may be active.
  * All transforms must reference the active configuration.
  * No hard-coded board size or anchor.
  * Coordinates must remain integers.
  * All geometry modules must call this layer.

# 8. Summary
  * VTS = fixed 30×30×30
  * RCS = 1-offset, LL-based notation
  * Board size + anchor are coupled
  * Supports symmetric and asymmetric boards
  * Coordinates are always integers
  * OFFBOARD is structured
  * Transforms are invertible and deterministic

  End of L0 coordinate specification.
